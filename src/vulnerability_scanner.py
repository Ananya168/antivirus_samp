import os
import platform
from typing import List, Dict
import time 
class VulnerabilityScanner:
    def __init__(self):
        self.vulnerabilities = []
        self.scan_history = []
    
    def scan_system(self) -> List[Dict]:
        """Scan system for common vulnerabilities"""
        self.vulnerabilities = []
        
        self._check_firewall()
        self._check_updates()
        self._check_user_accounts()
        self._check_shared_folders()
        self._check_autostart_programs()
        self._check_antivirus()
        
        scan_result = {
            'timestamp': time.time(),
            'vulnerabilities_found': len(self.vulnerabilities),
            'vulnerabilities': self.vulnerabilities.copy()
        }
        self.scan_history.append(scan_result)
        
        return self.vulnerabilities
    
    def _check_firewall(self):
        """Check if firewall might be disabled"""
        self.vulnerabilities.append({
            'type': 'FIREWALL_STATUS',
            'severity': 'MEDIUM',
            'description': 'Firewall status unknown - verify it is enabled',
            'fix': 'Check Windows Firewall or system firewall settings',
            'category': 'Network'
        })
    
    def _check_updates(self):
        """Check for system updates"""
        self.vulnerabilities.append({
            'type': 'SYSTEM_UPDATES',
            'severity': 'MEDIUM', 
            'description': 'Ensure system is up to date with latest security patches',
            'fix': 'Run system updates regularly',
            'category': 'System'
        })
    
    def _check_user_accounts(self):
        """Check for user account issues"""
        self.vulnerabilities.append({
            'type': 'USER_ACCOUNTS',
            'severity': 'LOW',
            'description': 'Review user accounts for security best practices',
            'fix': 'Ensure all accounts have strong passwords and limited privileges',
            'category': 'Accounts'
        })
    
    def _check_shared_folders(self):
        """Check for insecure shared folders"""
        self.vulnerabilities.append({
            'type': 'SHARED_FOLDERS',
            'severity': 'MEDIUM',
            'description': 'Check for insecurely shared folders on network',
            'fix': 'Review folder sharing permissions and network shares',
            'category': 'File System'
        })
    
    def _check_autostart_programs(self):
        """Check autostart programs"""
        self.vulnerabilities.append({
            'type': 'STARTUP_PROGRAMS',
            'severity': 'MEDIUM',
            'description': 'Review programs that start automatically with system',
            'fix': 'Check and manage startup programs in Task Manager',
            'category': 'System'
        })
    
    def _check_antivirus(self):
        """Check antivirus status"""
        self.vulnerabilities.append({
            'type': 'ANTIVIRUS_STATUS',
            'severity': 'HIGH',
            'description': 'Ensure antivirus software is installed and updated',
            'fix': 'Install and regularly update antivirus software',
            'category': 'Security'
        })
    
    def get_scan_summary(self) -> Dict:
        """Get summary of last scan"""
        if not self.scan_history:
            return {'total_vulnerabilities': 0, 'last_scan': 'Never'}
        
        last_scan = self.scan_history[-1]
        return {
            'total_vulnerabilities': last_scan['vulnerabilities_found'],
            'last_scan': time.ctime(last_scan['timestamp']),
            'high_severity': len([v for v in last_scan['vulnerabilities'] if v['severity'] == 'HIGH'])
        }

 # Add this at the top